# DatingApp

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ssl
#### mkdir nginx/ssl
#### openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout ./nginx/ssl/selfsigned.key -out ./nginx/ssl/selfsigned.crt -subj "/C=RU/ST=State/L=City/O=Organization/OU=Department/CN=${vps_ip}"

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
#### –≤ –∫–∞–∂–¥–æ–π –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω—è—Ö .env.example –ø–æ –ø–æ–¥–æ–±–∏—é —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã .env


## üí° –û–±—â–∞—è –∏–¥–µ—è

–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ç—Ä–∏ —Å—É—â–Ω–æ—Å—Ç–∏:

### 1. **–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ**

–°–ª—É–∂–∏—Ç –¥–ª—è –ø—Ä–µ–≤—å—é —á–∞—Ç–æ–≤: —É—á–∞—Å—Ç–Ω–∏–∫–∏, –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è. –•—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫:


`chat:<chat_id> => {   "id": "chat_1",   "participants": ["user1", "user2"],   "crchat:<chat_id> => {
  "id": "chat_1",
  "participants": ["user1", "user2"],
  "created_at": 1713705600000,
  "last_message_id": "msg_3"
}


‚û° Redis —Ç–∏–ø: `Hash`

---

### 2. **–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)**

–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –∫—Ç–æ —á—Ç–æ —á–∏—Ç–∞–ª, –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ.


chat:<chat_id>:read_status => {
  "user1": "msg_2",
  "user2": null
}


‚û° Redis —Ç–∏–ø: `Hash` (`userId` ‚Üí `last_read_message_id`)

---

### 3. **–°–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—á—Ç–µ–Ω–∏—è**

–ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

chat:<chat_id>:messages => {
  "msg_1": "{...}",
  "msg_2": "{...}",
  "msg_3": "{...}"
}
chat:<chat_id>:order => [timestamp, message_id, ...]


‚û° Redis —Ç–∏–ø:

- `Hash` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (`message_id` ‚Üí JSON-—Å–æ–æ–±—â–µ–Ω–∏–µ)
    
- `Sorted Set` –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ (`score` = `timestamp`, `value` = `message_id`)
    

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å|–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ|
|---|---|
|üîÅ **–ò–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å**|–õ—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –±–µ–∑ –ø–µ—Ä–µ–±–æ—Ä–∞ —Å–ø–∏—Å–∫–∞|
|üß† **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å**|–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–∞-–∏–Ω—Ñ—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏–π —É–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ|
|üîç **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**|–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é, –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º –∏ –∏—Å—Ç–æ—Ä–∏–∏|
|üö¶ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ—á—Ç–µ–Ω–∏—è**|–ú–æ–∂–Ω–æ —Ç–æ—á–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –ø—Ä–æ—á–∏—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ|

---

## üì¶ –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Redis-–∫–ª—é—á–µ–π

|–¢–∏–ø|–ö–ª—é—á|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|---|
|`Hash`|`chat:<chatId>`|–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ|
|`Hash`|`chat:<chatId>:read_status`|–ö—Ç–æ —á—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª|
|`Hash`|`chat:<chatId>:messages`|–°–æ–æ–±—â–µ–Ω–∏—è|
|`ZSet`|`chat:<chatId>:order`|–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π|

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `chat:<id>:messages`
    
2. –û–±–Ω–æ–≤–ª—è–µ–º `chat:<id>:order`
    
3. –û–±–Ω–æ–≤–ª—è–µ–º `last_message_id` –≤ `chat:<id>`
    

---

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

1. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º `chat:<id>:messages[message_id]`

---

### ‚úÖ –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —á–∞—Ç–∞

1. –û–±–Ω–æ–≤–ª—è–µ–º `chat:<id>:read_status[user_id]`
    
2. –ú–æ–∂–Ω–æ –≤ —Ñ–æ–Ω–µ –æ–±–Ω–æ–≤–∏—Ç—å `is_read` –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    

---

### ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é

–ë–µ—Ä—ë–º –∏–∑ `chat:<id>`, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º `last_message_id` –∏–∑ `messages` ‚Äî –≥–æ—Ç–æ–≤–æ.

---

### ‚úÖ –ü–æ–¥—Å—á—ë—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –º–µ—Ç–∫—É `last_read_message_id` –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `order`, –Ω–∞—á–∏–Ω–∞—è —Å –Ω–µ—ë.